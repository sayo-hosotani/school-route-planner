# TODO リスト

> 完了済みタスクは [DONE.md](./DONE.md) を参照

## 1. コードリファクタリング（優先度: 中）

### 1.1. App.tsx の改善（継続）
App.tsxを415行→227行に削減済み。残りの改善項目：

- [ ] Context API の検討
  - `PointContext`: ポイント状態と操作関数の共有
  - `RouteContext`: 経路状態の共有
  - Sidebarへのprops drilling（13個以上）を解消
- [ ] エラーハンドリングの統一
  - try-catchパターンを共通関数化
  - エラー時のフォールバック処理を統一

### 1.2. 全体的なコード改善
- [ ] 型定義の整理
  - ハンドラ関数の型を`types/handlers.ts`に集約
  - 共通で使用する型を`types/common.ts`に
- [ ] ユーティリティ関数の整理
  - 日時フォーマット関数
  - ポイント関連のヘルパー関数
- [ ] APIエラーハンドリングの共通化
  - `api/`内でエラーハンドリングを統一
  - カスタムエラークラスの導入

## 2. UI/UX改善（優先度: 低）

### 2.1. スタイリング
- [ ] 左側パネルのデザイン
- [ ] ボタンのスタイル統一
- [ ] レスポンシブ対応

### 2.2. エラーハンドリング・ローディング
- [ ] API呼び出しエラー時の表示
- [ ] バリデーションエラーの表示
- [ ] 経路生成中のインジケーター
- [ ] データ読み込み中のスケルトン表示

### 2.3. 新機能
- [ ] 地図画像ダウンロード機能
  - 表示中の経路をPNG画像としてダウンロード
  - Scale以外のコントロール（Zoom、Coordinate、Attribution等）を非表示にして画像化
  - leaflet-imageやhtml2canvasなどのライブラリを検討
- [ ] 経路上にポイントをフィットさせるボタンの追加

### 2.4. サイドバーの改善（継続）
- [ ] 通常モードと編集モードでコンポーネントを別にすべきか検討
- [ ] コメント表示/編集周りの改善検討（HTMLレンダリング、リッチテキスト対応等）
- [ ] スタイルの分離
  - 全コンポーネントでインラインスタイルが多用されている
  - CSS Modulesまたはスタイルファイルに分離
  - 重複するボタンスタイルを共通コンポーネント化
- [ ] propsの整理
  - `SidebarProps`が13個以上のpropsを持ち複雑
  - 関連するpropsをオブジェクトにグループ化（例: pointHandlers, routeHandlers）
- [ ] カスタムフックの抽出
  - `SavedRouteList`: フェッチ・削除ロジックを`useSavedRoutes`フックに
  - `PointItem`: コメント編集ロジックを`useCommentEditor`フックに
- [ ] ユーティリティ関数の分離
  - `getPointTypeLabel`、`getDisplayTitle`を`utils/point-utils.ts`に移動
- [ ] 定数の共通化
  - カラーコード（#007bff, #28a745, #dc3545等）を定数ファイルに集約
- [ ] アクセシビリティ改善
  - ボタンにaria-label属性を追加
  - キーボードナビゲーション対応（Tab、Enter、Escape）
- [ ] パフォーマンス最適化
  - `PointItem`のReact.memo化を検討
  - 不要な再レンダリングの防止

## 3. 認証機能（優先度: 低）
- [ ] ユーザー登録・ログイン画面
- [ ] JWT認証実装
  - @fastify/jwtプラグイン導入
  - ログイン/登録エンドポイント
- [ ] フロントエンド: 認証状態管理
  - トークンの保存（localStorage）
  - APIリクエストにトークン付与
- [ ] 認証が必要なエンドポイントに認証チェック追加

## 4. テスト（優先度: 低）
- [ ] バックエンドのテスト
  - ルートのテスト
  - サービス層のテスト
- [ ] フロントエンドのテスト
  - コンポーネントのテスト

## 5. 本番環境準備（優先度: 低）
- [ ] 本番ビルドスクリプト作成
  - フロントエンドビルド → バックエンドpublicにコピー
- [ ] 静的ファイル配信設定
  - @fastify/staticプラグイン導入
  - publicディレクトリの配信設定
- [ ] 環境変数管理
  - .env.example作成
  - 本番用の環境変数設定
- [ ] デプロイ手順書作成

## メモ
- CLAUDE.mdに設計が詳しく記載されている
- バックエンドAPI: http://localhost:3000
- フロントエンド: http://localhost:5173
- 開発時の起動: `npm run dev:all`
