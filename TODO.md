# TODO リスト

## 現在の状態
- ✅ プロジェクト構成（モノレポ）
- ✅ フロントエンド: 地図表示、サンプル経路表示
- ✅ バックエンド: 経路保存・読み込みAPI（route.txt）
- ✅ フロントエンド: API連携、保存・読み込みボタン実装

## 次にやるべきこと

### 1. フロントエンド: API連携（優先度: 高）
- [x] APIクライアント作成（`packages/frontend/src/api/route-api.ts`）
  - POST /routes（経路保存）
  - GET /routes（経路読み込み）
- [x] 保存ボタンの実装
  - 現在の経路データをバックエンドに送信
- [x] 読み込みボタンの実装
  - 保存済み経路をバックエンドから取得して表示

### 2. フロントエンド: 編集モード実装（優先度: 高）
- [ ] モード管理（useState）
  - 通常モード / 編集モード の切り替え
- [ ] 左側パネル作成
  - モード切り替えボタン
  - 保存/読み込みボタン（通常モード）
  - ポイント一覧表示
- [ ] 地図クリックでポイント追加
  - 編集モード時のみ有効
  - 追加順に応じて種別を自動判定（start/waypoint/goal）
- [ ] ポイント編集モーダル
  - コメント入力
  - 種別変更
  - 削除ボタン
- [ ] ポイントのドラッグ移動
  - react-leafletのMarkerにdraggable属性を追加
  - ドラッグ終了時の処理

### 3. 経路生成機能（優先度: 中）
- [ ] Valhalla API連携の調査
  - ローカルで動かすか、外部サービスを使うか決定
  - Docker Composeでの起動方法検討
- [ ] バックエンド: Valhalla APIへのリクエスト処理
  - `packages/backend/src/services/route-service.ts` 作成
  - ポイント配列からValhalla APIリクエスト生成
  - レスポンスをGeoJSON形式に変換
- [ ] フロントエンド: 自動経路生成
  - ポイント追加時に経路生成APIを呼び出し
  - ポイント移動終了時に経路生成APIを呼び出し

### 4. データベース対応（優先度: 中）
- [ ] PostgreSQL環境構築
  - Docker Composeでの起動設定
- [ ] マイグレーション作成
  - usersテーブル
  - pointsテーブル
  - routesテーブル
  - commentsテーブル（または pointsテーブルに含める）
- [ ] Kysely設定
  - データベース接続
  - 型生成
- [ ] Repository層実装
  - route-repository.ts
  - point-repository.ts
- [ ] Service層実装
  - route-service.ts（既存のファイル保存処理をDB保存に変更）
- [ ] ルート更新
  - route.txtではなくDBに保存・読み込み

### 5. 認証機能（優先度: 低）
- [ ] ユーザー登録・ログイン画面
- [ ] JWT認証実装
  - @fastify/jwtプラグイン導入
  - ログイン/登録エンドポイント
- [ ] フロントエンド: 認証状態管理
  - トークンの保存（localStorage）
  - APIリクエストにトークン付与
- [ ] 認証が必要なエンドポイントに認証チェック追加

### 6. UI/UX改善（優先度: 低）
- [ ] スタイリング
  - 左側パネルのデザイン
  - ボタンのスタイル統一
  - レスポンシブ対応
- [ ] エラーハンドリング
  - API呼び出しエラー時の表示
  - バリデーションエラーの表示
- [ ] ローディング表示
  - 経路生成中のインジケーター
  - データ読み込み中のスケルトン表示

### 7. テスト（優先度: 低）
- [ ] バックエンドのテスト
  - ルートのテスト
  - サービス層のテスト
- [ ] フロントエンドのテスト
  - コンポーネントのテスト

### 8. 本番環境準備（優先度: 低）
- [ ] 本番ビルドスクリプト作成
  - フロントエンドビルド → バックエンドpublicにコピー
- [ ] 静的ファイル配信設定
  - @fastify/staticプラグイン導入
  - publicディレクトリの配信設定
- [ ] 環境変数管理
  - .env.example作成
  - 本番用の環境変数設定
- [ ] デプロイ手順書作成

## メモ
- CLAUDE.mdに設計が詳しく記載されている
- サンプルデータは`packages/frontend/src/data/sample-route.ts`
- バックエンドAPI: http://localhost:3000
- フロントエンド: http://localhost:5173
- 開発時の起動: `npm run dev:all`
